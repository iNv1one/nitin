{% extends 'base.html' %}

{% block title %}Группы ключевых слов - NITIN{% endblock %}

{% block extra_head %}
<style>
    .btn-dark-custom {
        background-color: #1a1a24;
        border-color: #1a1a24;
        color: white;
    }
    .btn-dark-custom:hover {
        background-color: #0d0d12;
        border-color: #0d0d12;
        color: white;
    }
    
    /* Toggle Switch Styles */
    .toggle-switch {
        position: relative;
        display: inline-block;
        width: 50px;
        height: 24px;
    }

    .toggle-switch input {
        opacity: 0;
        width: 0;
        height: 0;
    }

    .toggle-slider {
        position: absolute;
        cursor: pointer;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: #ccc;
        transition: .3s;
        border-radius: 24px;
    }

    .toggle-slider:before {
        position: absolute;
        content: "";
        height: 18px;
        width: 18px;
        left: 3px;
        bottom: 3px;
        background-color: white;
        transition: .3s;
        border-radius: 50%;
    }

    .toggle-switch input:checked + .toggle-slider {
        background-color: #28a745;
    }

    .toggle-switch input:checked + .toggle-slider:before {
        transform: translateX(26px);
    }

    .toggle-switch input:disabled + .toggle-slider {
        opacity: 0.5;
        cursor: not-allowed;
    }
    
    /* Кликабельные строки таблицы */
    .clickable-row {
        cursor: pointer;
    }
    
    .clickable-row:hover {
        background-color: #e3e8ed !important;
    }
    
    /* Стили для offcanvas формы */
    #editGroupOffcanvas .toggle-switch,
    #createGroupOffcanvas .toggle-switch {
        position: relative;
        display: inline-block;
        width: 50px;
        height: 24px;
    }

    #editGroupOffcanvas .toggle-switch input,
    #createGroupOffcanvas .toggle-switch input {
        opacity: 0;
        width: 0;
        height: 0;
    }

    #editGroupOffcanvas .slider,
    #createGroupOffcanvas .slider,
    #editGroupOffcanvas .toggle-slider,
    #createGroupOffcanvas .toggle-slider {
        position: absolute;
        cursor: pointer;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: #ccc;
        transition: 0.4s;
        border-radius: 24px;
    }

    #editGroupOffcanvas .slider:before,
    #createGroupOffcanvas .slider:before,
    #editGroupOffcanvas .toggle-slider:before,
    #createGroupOffcanvas .toggle-slider:before {
        position: absolute;
        content: "";
        height: 18px;
        width: 18px;
        left: 3px;
        bottom: 3px;
        background-color: white;
        transition: 0.4s;
        border-radius: 50%;
    }

    #editGroupOffcanvas input:checked + .slider,
    #createGroupOffcanvas input:checked + .slider,
    #editGroupOffcanvas input:checked + .toggle-slider,
    #createGroupOffcanvas input:checked + .toggle-slider {
        background-color: #28a745;
    }

    #editGroupOffcanvas input:checked + .slider:before,
    #createGroupOffcanvas input:checked + .slider:before,
    #editGroupOffcanvas input:checked + .toggle-slider:before,
    #createGroupOffcanvas input:checked + .toggle-slider:before {
        transform: translateX(26px);
    }

    #editGroupOffcanvas input:disabled + .slider,
    #createGroupOffcanvas input:disabled + .slider,
    #editGroupOffcanvas input:disabled + .toggle-slider,
    #createGroupOffcanvas input:disabled + .toggle-slider {
        cursor: not-allowed;
        opacity: 0.6;
    }
</style>
{% endblock %}

{% block content %}
<!-- Заголовок страницы -->
<div class="row mb-4">
    <div class="col-12">
        <div class="d-flex justify-content-between align-items-center">
            <h2>Группы ключевых слов</h2>
            <button class="btn btn-dark-custom" onclick="openCreatePanel()">
                <i class="fas fa-plus"></i> Добавить группу
            </button>
        </div>
    </div>
</div>

<!-- Список групп -->
<div class="row">
    <div class="col-12">
        {% if page_obj %}
            <div class="table-responsive">
                <table class="table table-hover">
                    <thead class="table-light">
                        <tr>
                            <th>Название</th>
                            <th>Ключевые слова</th>
                            <th>AI Фильтр</th>
                            <th>Статус</th>
                            <th>Создана</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for group in page_obj %}
                        <tr class="clickable-row" onclick="openEditPanel({{ group.id }})">
                            <td>{{ group.name }}</td>
                            <td>
                                <span class="badge bg-secondary">{{ group.keywords_count }} слов</span>
                                <br>
                                <small class="text-muted">{{ group.get_keywords_display }}</small>
                            </td>
                            <td>
                                <label class="toggle-switch">
                                    <input type="checkbox" 
                                           {% if group.use_ai_filter %}checked{% endif %}
                                           disabled>
                                    <span class="toggle-slider"></span>
                                </label>
                            </td>
                            <td>
                                <label class="toggle-switch">
                                    <input type="checkbox" 
                                           {% if group.is_active %}checked{% endif %}
                                           disabled>
                                    <span class="toggle-slider"></span>
                                </label>
                            </td>
                            <td>{{ group.created_at|date:"d.m.Y H:i" }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>

            <!-- Пагинация -->
            {% if page_obj.has_other_pages %}
            <nav>
                <ul class="pagination justify-content-center">
                    {% if page_obj.has_previous %}
                        <li class="page-item">
                            <a class="page-link" href="?page={{ page_obj.previous_page_number }}">Предыдущая</a>
                        </li>
                    {% endif %}
                    
                    {% for num in page_obj.paginator.page_range %}
                        <li class="page-item {% if page_obj.number == num %}active{% endif %}">
                            <a class="page-link" href="?page={{ num }}">{{ num }}</a>
                        </li>
                    {% endfor %}
                    
                    {% if page_obj.has_next %}
                        <li class="page-item">
                            <a class="page-link" href="?page={{ page_obj.next_page_number }}">Следующая</a>
                        </li>
                    {% endif %}
                </ul>
            </nav>
            {% endif %}
        {% else %}
            <div class="alert alert-warning">
                <i class="fas fa-exclamation-triangle"></i> 
                У вас пока нет групп ключевых слов. Создайте первую группу!
            </div>
        {% endif %}
    </div>
</div>

<!-- Секция шаблонов сообщений -->
<div class="row mt-5">
    <div class="col-12">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <div>
                <h3>Шаблоны сообщений</h3>
                <p class="text-muted">Создавайте шаблоны для быстрой отправки сообщений лидам</p>
            </div>
            <button onclick="openCreateTemplatePanel()" class="btn btn-dark-custom">
                <i class="fas fa-plus"></i> Создать шаблон
            </button>
        </div>
    </div>
</div>

<div class="row">
    <div class="col-12">
        {% if templates %}
        <div class="card shadow-sm">
            <div class="card-body p-0">
                <div class="table-responsive">
                    <table class="table table-hover mb-0">
                        <thead class="table-light">
                            <tr>
                                <th style="width: 25%;">Название</th>
                                <th style="width: 60%;">Текст шаблона</th>
                                <th style="width: 15%;">Создан</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for template in templates %}
                            <tr style="cursor: pointer;" onclick="openEditTemplatePanel({{ template.id }})">
                                <td>
                                    <strong>{{ template.name }}</strong>
                                    {% if template.subject %}
                                    <br><small class="text-muted">{{ template.subject }}</small>
                                    {% endif %}
                                    {% if template.is_default %}
                                    <br><span class="badge bg-primary mt-1">По умолчанию</span>
                                    {% endif %}
                                </td>
                                <td>
                                    <div style="max-width: 600px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">
                                        {{ template.template_text|truncatewords:30 }}
                                    </div>
                                </td>
                                <td>
                                    <small class="text-muted">{{ template.created_at|date:"d.m.Y H:i" }}</small>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        {% else %}
        <div class="alert alert-info">
            <i class="fas fa-info-circle"></i> 
            У вас пока нет шаблонов сообщений. Создайте первый шаблон для быстрой отправки сообщений!
        </div>
        {% endif %}
    </div>
</div>

<!-- Offcanvas для создания группы -->
<div class="offcanvas offcanvas-end" tabindex="-1" id="createGroupOffcanvas" style="width: 600px;">
    <div class="offcanvas-header">
        <h5 class="offcanvas-title" id="createGroupOffcanvasLabel">Создать группу</h5>
        <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
    </div>
    <div class="offcanvas-body">
        <div id="createGroupContent">
            <div class="text-center py-5">
                <div class="spinner-border text-primary" role="status">
                    <span class="visually-hidden">Загрузка...</span>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Offcanvas для редактирования группы -->
<div class="offcanvas offcanvas-end" tabindex="-1" id="editGroupOffcanvas" style="width: 600px;">
    <div class="offcanvas-header">
        <h5 class="offcanvas-title" id="editGroupOffcanvasLabel">Редактировать группу</h5>
        <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
    </div>
    <div class="offcanvas-body">
        <div id="editGroupContent">
            <div class="text-center py-5">
                <div class="spinner-border text-primary" role="status">
                    <span class="visually-hidden">Загрузка...</span>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
function openEditPanel(groupId) {
    // Открываем offcanvas
    const offcanvasEl = document.getElementById('editGroupOffcanvas');
    const offcanvas = new bootstrap.Offcanvas(offcanvasEl);
    offcanvas.show();
    
    // Загружаем содержимое через AJAX
    const url = `/keywords/${groupId}/edit/`;
    
    fetch(url)
        .then(response => response.text())
        .then(html => {
            // Создаем временный div для парсинга HTML
            const parser = new DOMParser();
            const doc = parser.parseFromString(html, 'text/html');
            
            // Извлекаем содержимое формы
            const content = doc.querySelector('.card-body') || doc.querySelector('form');
            
            if (content) {
                document.getElementById('editGroupContent').innerHTML = content.outerHTML;
                
                // Переопределяем submit формы для AJAX
                const form = document.querySelector('#editGroupContent form');
                if (form) {
                    form.onsubmit = function(e) {
                        e.preventDefault();
                        submitEditForm(form, groupId);
                    };
                }
                
                // Инициализируем функционал AI фильтра
                const aiFilterCheckbox = document.getElementById('use_ai_filter');
                const aiPromptContainer = document.getElementById('ai_prompt_container');
                
                if (aiFilterCheckbox && aiPromptContainer) {
                    aiFilterCheckbox.addEventListener('change', function() {
                        if (this.checked) {
                            aiPromptContainer.style.display = 'block';
                        } else {
                            aiPromptContainer.style.display = 'none';
                        }
                    });
                }
            } else {
                document.getElementById('editGroupContent').innerHTML = html;
            }
        })
        .catch(error => {
            console.error('Error loading form:', error);
            document.getElementById('editGroupContent').innerHTML = 
                '<div class="alert alert-danger">Ошибка загрузки формы</div>';
        });
}

function submitEditForm(form, groupId) {
    const formData = new FormData(form);
    const url = form.action || `/keywords/${groupId}/edit/`;
    
    fetch(url, {
        method: 'POST',
        body: formData,
        headers: {
            'X-Requested-With': 'XMLHttpRequest'
        }
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            // Закрываем offcanvas
            const offcanvasEl = document.getElementById('editGroupOffcanvas');
            const offcanvas = bootstrap.Offcanvas.getInstance(offcanvasEl);
            offcanvas.hide();
            
            // Перезагружаем страницу для отображения изменений
            location.reload();
        } else {
            // Показываем ошибки в форме
            if (data.errors) {
                // Здесь можно добавить отображение ошибок
                alert('Ошибка: ' + JSON.stringify(data.errors));
            }
        }
    })
    .catch(error => {
        console.error('Error submitting form:', error);
        alert('Ошибка при сохранении');
    });
}

// Функции для создания группы
function openCreatePanel() {
    // Открываем offcanvas
    const offcanvasEl = document.getElementById('createGroupOffcanvas');
    const offcanvas = new bootstrap.Offcanvas(offcanvasEl);
    offcanvas.show();
    
    // Загружаем содержимое через AJAX
    const url = '/keywords/create/';
    
    fetch(url)
        .then(response => response.text())
        .then(html => {
            // Создаем временный div для парсинга HTML
            const parser = new DOMParser();
            const doc = parser.parseFromString(html, 'text/html');
            
            // Извлекаем содержимое формы
            const content = doc.querySelector('.card-body') || doc.querySelector('form');
            
            if (content) {
                document.getElementById('createGroupContent').innerHTML = content.outerHTML;
                
                // Переопределяем submit формы для AJAX
                const form = document.querySelector('#createGroupContent form');
                if (form) {
                    form.onsubmit = function(e) {
                        e.preventDefault();
                        submitCreateForm(form);
                    };
                }
                
                // Инициализируем функционал AI фильтра
                const aiFilterCheckbox = document.getElementById('use_ai_filter');
                const aiPromptContainer = document.getElementById('ai_prompt_container');
                
                if (aiFilterCheckbox && aiPromptContainer) {
                    aiFilterCheckbox.addEventListener('change', function() {
                        if (this.checked) {
                            aiPromptContainer.style.display = 'block';
                        } else {
                            aiPromptContainer.style.display = 'none';
                        }
                    });
                }
            } else {
                document.getElementById('createGroupContent').innerHTML = html;
            }
        })
        .catch(error => {
            console.error('Error loading form:', error);
            document.getElementById('createGroupContent').innerHTML = 
                '<div class="alert alert-danger">Ошибка загрузки формы</div>';
        });
}

function submitCreateForm(form) {
    const formData = new FormData(form);
    // Явно используем правильный URL, не берем из form.action
    const url = '{% url "dashboard:create_keyword_group" %}';
    
    console.log('Submitting to URL:', url);
    console.log('FormData:', Array.from(formData.entries()));
    
    fetch(url, {
        method: 'POST',
        body: formData,
        headers: {
            'X-Requested-With': 'XMLHttpRequest'
        }
    })
    .then(response => {
        console.log('Response status:', response.status);
        console.log('Response headers:', response.headers.get('content-type'));
        
        // Проверяем, что ответ действительно JSON
        const contentType = response.headers.get('content-type');
        if (!contentType || !contentType.includes('application/json')) {
            // Логируем текст ответа для отладки
            return response.text().then(text => {
                console.error('Server response (not JSON):', text.substring(0, 500));
                throw new TypeError("Сервер вернул не JSON ответ. Проверьте консоль для деталей.");
            });
        }
        return response.json();
    })
    .then(data => {
        console.log('Parsed JSON data:', data);
        if (data.success) {
            // Закрываем offcanvas
            const offcanvasEl = document.getElementById('createGroupOffcanvas');
            const offcanvas = bootstrap.Offcanvas.getInstance(offcanvasEl);
            offcanvas.hide();
            
            
            // Перезагружаем страницу для отображения изменений
            location.reload();
        } else {
            // Показываем ошибки в форме
            if (data.errors) {
                alert('Ошибка: ' + JSON.stringify(data.errors));
            } else if (data.message) {
                alert(data.message);
            }
        }
    })
    .catch(error => {
        console.error('Error submitting form:', error);
        alert('Ошибка при создании: ' + error.message);
    });
}

// Функция для удаления группы из offcanvas
function deleteGroup(groupId, groupName) {
    if (confirm(`Вы уверены, что хотите удалить группу "${groupName}"?`)) {
        // Получаем CSRF токен из формы
        const csrfToken = document.querySelector('#editGroupContent [name=csrfmiddlewaretoken]').value;
        
        // Отправляем POST запрос на удаление
        fetch(`/keywords/${groupId}/delete/`, {
            method: 'POST',
            headers: {
                'X-CSRFToken': csrfToken,
                'Content-Type': 'application/x-www-form-urlencoded',
            }
        })
        .then(response => {
            if (response.ok) {
                // Закрываем offcanvas
                const offcanvasEl = document.getElementById('editGroupOffcanvas');
                const offcanvas = bootstrap.Offcanvas.getInstance(offcanvasEl);
                offcanvas.hide();
                
                // Перезагружаем страницу
                location.reload();
            } else {
                alert('Ошибка при удалении группы');
            }
        })
        .catch(error => {
            console.error('Error deleting group:', error);
            alert('Ошибка при удалении группы');
        });
    }
}

// Функция открытия панели создания шаблона
function openCreateTemplatePanel() {
    const offcanvas = new bootstrap.Offcanvas(document.getElementById('createTemplateOffcanvas'));
    const content = document.getElementById('createTemplateContent');
    
    // Показываем спиннер
    content.innerHTML = `
        <div class="d-flex justify-content-center align-items-center" style="height: 200px;">
            <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">Загрузка...</span>
            </div>
        </div>
    `;
    
    offcanvas.show();
    
    // Загружаем форму
    fetch('{% url "dashboard:create_message_template" %}')
        .then(response => response.text())
        .then(html => {
            const parser = new DOMParser();
            const doc = parser.parseFromString(html, 'text/html');
            const form = doc.querySelector('form');
            
            if (form) {
                content.innerHTML = form.outerHTML;
            } else {
                content.innerHTML = '<div class="alert alert-danger">Ошибка загрузки формы</div>';
            }
        })
        .catch(error => {
            console.error('Error loading template form:', error);
            content.innerHTML = '<div class="alert alert-danger">Ошибка загрузки формы</div>';
        });
}

// Функция открытия панели редактирования шаблона
let currentEditingTemplateId = null; // Глобальная переменная для хранения ID

function openEditTemplatePanel(templateId) {
    currentEditingTemplateId = templateId; // Сохраняем ID
    
    const offcanvas = new bootstrap.Offcanvas(document.getElementById('editTemplateOffcanvas'));
    const content = document.getElementById('editTemplateContent');
    
    // Показываем спиннер
    content.innerHTML = `
        <div class="d-flex justify-content-center align-items-center" style="height: 200px;">
            <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">Загрузка...</span>
            </div>
        </div>
    `;
    
    offcanvas.show();
    
    // Загружаем форму редактирования
    fetch(`/templates/${templateId}/edit/`)
        .then(response => response.text())
        .then(html => {
            const parser = new DOMParser();
            const doc = parser.parseFromString(html, 'text/html');
            const form = doc.querySelector('form');
            
            if (form) {
                content.innerHTML = form.outerHTML;
            } else {
                content.innerHTML = '<div class="alert alert-danger">Ошибка загрузки формы</div>';
            }
        })
        .catch(error => {
            console.error('Error loading template form:', error);
            content.innerHTML = '<div class="alert alert-danger">Ошибка загрузки формы</div>';
        });
}

// Обработка отправки формы создания шаблона
document.addEventListener('submit', function(e) {
    if (e.target.closest('#createTemplateContent form')) {
        e.preventDefault();
        submitCreateTemplateForm();
    }
    if (e.target.closest('#editTemplateContent form')) {
        e.preventDefault();
        submitEditTemplateForm();
    }
});

function submitCreateTemplateForm() {
    const form = document.querySelector('#createTemplateContent form');
    const formData = new FormData(form);
    
    fetch('{% url "dashboard:create_message_template" %}', {
        method: 'POST',
        body: formData,
        headers: {
            'X-Requested-With': 'XMLHttpRequest'
        }
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            // Закрываем offcanvas
            const offcanvasEl = document.getElementById('createTemplateOffcanvas');
            const offcanvas = bootstrap.Offcanvas.getInstance(offcanvasEl);
            offcanvas.hide();
            
            // Показываем toast уведомление
            showToast('Шаблон успешно создан');
            
            // Перезагружаем страницу
            setTimeout(() => location.reload(), 1000);
        } else {
            // Показываем ошибки
            alert(data.errors || 'Ошибка при создании шаблона');
        }
    })
    .catch(error => {
        console.error('Error creating template:', error);
        alert('Ошибка при создании шаблона');
    });
}

function submitEditTemplateForm() {
    const form = document.querySelector('#editTemplateContent form');
    const formData = new FormData(form);
    
    // Используем сохраненный ID шаблона
    if (!currentEditingTemplateId) {
        alert('Ошибка: не удалось определить ID шаблона');
        return;
    }
    
    fetch(`/templates/${currentEditingTemplateId}/edit/`, {
        method: 'POST',
        body: formData,
        headers: {
            'X-Requested-With': 'XMLHttpRequest'
        }
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            // Закрываем offcanvas
            const offcanvasEl = document.getElementById('editTemplateOffcanvas');
            const offcanvas = bootstrap.Offcanvas.getInstance(offcanvasEl);
            offcanvas.hide();
            
            // Показываем toast уведомление
            showToast('Шаблон успешно обновлен');
            
            // Перезагружаем страницу
            setTimeout(() => location.reload(), 1000);
        } else {
            // Показываем ошибки
            alert(data.errors || 'Ошибка при обновлении шаблона');
        }
    })
    .catch(error => {
        console.error('Error updating template:', error);
        alert('Ошибка при обновлении шаблона');
    });
}

// Функция удаления шаблона
function deleteTemplate(templateId, templateName) {
    if (confirm(`Вы уверены, что хотите удалить шаблон "${templateName}"?`)) {
        const csrfToken = document.querySelector('#editTemplateContent [name=csrfmiddlewaretoken]').value;
        
        fetch(`/templates/${templateId}/delete/`, {
            method: 'POST',
            headers: {
                'X-CSRFToken': csrfToken,
                'Content-Type': 'application/x-www-form-urlencoded',
            }
        })
        .then(response => {
            if (response.ok) {
                const offcanvasEl = document.getElementById('editTemplateOffcanvas');
                const offcanvas = bootstrap.Offcanvas.getInstance(offcanvasEl);
                offcanvas.hide();
                
                location.reload();
            } else {
                alert('Ошибка при удалении шаблона');
            }
        })
        .catch(error => {
            console.error('Error deleting template:', error);
            alert('Ошибка при удалении шаблона');
        });
    }
}

function showToast(message) {
    // Создаем toast элемент если его нет
    let toastContainer = document.querySelector('.toast-container');
    if (!toastContainer) {
        toastContainer = document.createElement('div');
        toastContainer.className = 'toast-container position-fixed top-0 end-0 p-3';
        document.body.appendChild(toastContainer);
    }
    
    const toastEl = document.createElement('div');
    toastEl.className = 'toast';
    toastEl.setAttribute('role', 'alert');
    toastEl.innerHTML = `
        <div class="toast-header bg-success text-white">
            <strong class="me-auto">Успешно</strong>
            <button type="button" class="btn-close btn-close-white" data-bs-dismiss="toast"></button>
        </div>
        <div class="toast-body">
            ${message}
        </div>
    `;
    
    toastContainer.appendChild(toastEl);
    const toast = new bootstrap.Toast(toastEl);
    toast.show();
    
    toastEl.addEventListener('hidden.bs.toast', () => {
        toastEl.remove();
    });
}
</script>

<!-- Offcanvas для создания шаблона -->
<div class="offcanvas offcanvas-end" tabindex="-1" id="createTemplateOffcanvas" style="width: 600px;">
    <div class="offcanvas-header border-bottom">
        <h5 class="offcanvas-title">Создать шаблон</h5>
        <button type="button" class="btn-close" data-bs-dismiss="offcanvas"></button>
    </div>
    <div class="offcanvas-body" id="createTemplateContent">
        <!-- Содержимое загружается через AJAX -->
    </div>
</div>

<!-- Offcanvas для редактирования шаблона -->
<div class="offcanvas offcanvas-end" tabindex="-1" id="editTemplateOffcanvas" style="width: 600px;">
    <div class="offcanvas-header border-bottom">
        <h5 class="offcanvas-title">Редактировать шаблон</h5>
        <button type="button" class="btn-close" data-bs-dismiss="offcanvas"></button>
    </div>
    <div class="offcanvas-body" id="editTemplateContent">
        <!-- Содержимое загружается через AJAX -->
    </div>
</div>
{% endblock %}




